package Spellbook::Exploit::Subdomain_Takeover_Check {
    use strict;
    use warnings;
    use LWP::UserAgent;
    use Digest::MD5 qw(md5_hex);

    sub new {
        my ($self, $parameters) = @_;
        my ($help, $target, @results);

        Getopt::Long::GetOptionsFromArray (
            $parameters,
            "h|help" => \$help,
            "t|target=s" => \$target,
        );

        if ($target) {
            my $useragent = LWP::UserAgent -> new(ssl_opts => { verify_hostname => 0 });
            my $request   = $useragent -> get("https://$target");

            if (($request -> code() == 200) || $request -> code() == 404) {
                my %hashes = (
                    github       => "1eb970ce5a18bec7165f016df8238566",
                    heroku       => "387caa8a924c5f92496824494b929207",
                    worksites    => "4f0aefb7ac3db0315363d9165585d227",
                    pantheonsite => "6beebac49b9868cf54affb45032e72b8",
                    tumblr       => "1ebbc4864c7d660ead6d119ade00763c",
                    helpjuice    => "7e4d0c57b27be09a44e1a35732680fd1",
                    helpscout    => "a563a9a7da84d0e9d52d405a37e041b1",
                    ghost        => "159f7f12f5e7b45da805419648ebebe2",
                    bitbucket    => "7db11fe884ef01aa7e94d402609f3841",
                    webflow      => "1d9896e6c6994806305469581db3bf1d",
                    wishpond     => "7a3624b16a9a6074e2a64989349ea503",
                    brightcove   => "9d242140330ebf8914b748e63fffa945",
                    bigcartel    => "a06edf45297c86b83c5c085d91ade642",
                    acquia       => "51f08e3e9063dab7c554ba16f647a1b9",
                    getresponse  => "a0c224a5e767789e0885ed524530d3d2",
                    jetbrains    => "2503573ca433de38437c19fd70c9a461",
                    zendesk      => "7b5ea53ba332630e5aca8e4abb807f70",
                    readme       => "1c4f7e1e60e392f4e483eae8f95c81d3",
                    # gitbook => "",
                );

                for (keys %hashes) {
                    if (md5_hex($request -> content()) eq $hashes{$_}) {
                        push @results, $target, "\n"; 
                    }
                }
            }

            return @results;
        }

        if ($help) {
            return "
                \rExploit::Subdomain_Takeover_Check
                \r==============
                \r-h, --help     See this menu
                \r-t, --target   Define a target\n\n";
        }
    }
}

1;
