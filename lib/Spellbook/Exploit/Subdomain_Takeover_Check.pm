package Spellbook::Exploit::Subdomain_Takeover_Check {
    use strict;
    use warnings;
    use LWP::UserAgent;
    use Digest::MD5 qw(md5_hex);

    sub new {
        my ($self, $parameters) = @_;
        my ($help, $target, @results);

        Getopt::Long::GetOptionsFromArray (
            $parameters,
            "h|help" => \$help,
            "t|target=s" => \$target,
        );

        if ($target) {
            my $ua = LWP::UserAgent -> new(
                ssl_opts => { verify_hostname => 0 }
            );

            my $request = $ua -> get("https://$target");

            if (($request -> code() == 200) || $request -> code() == 404) {
                my %hashes = (
                    github => "1eb970ce5a18bec7165f016df8238566",
                    heroku => "387caa8a924c5f92496824494b929207",
                    # gitbook => "",
                );

                for (keys %hashes) {
                    if (md5_hex($request -> content()) eq $hashes{$_}) {
                        push @results, $target, "\n"; 
                    }
                }
            }

            return @results;
        }

        if ($help) {
            return "
                \rExploit::Subdomain_Takeover_Check
                \r==============
                \r-h, --help     See this menu
                \r-t, --target   Define a target\n\n";
        }
    }
}

1;